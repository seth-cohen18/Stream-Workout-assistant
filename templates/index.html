<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stream AI Workout Assistant</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <style>
    :root {
      --primary-color: #3498db;
      --secondary-color: #2ecc71;
      --accent-color: #e74c3c;
      --text-color: #333;
      --bg-color: #f8f9fa;
      --card-bg: #ffffff;
      --border-color: #e0e0e0;
      --header-bg: #2c3e50;
      --header-text: #ecf0f1;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      --border-radius: 8px;
    }

    .dark-mode {
      --primary-color: #4fa3d1;
      --secondary-color: #2ecc71;
      --accent-color: #e74c3c;
      --text-color: #f0f0f0;
      --bg-color: #121212;
      --card-bg: #1e1e1e;
      --border-color: #333;
      --header-bg: #1a1a2e;
      --header-text: #f0f0f0;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      transition: background-color 0.3s, color 0.3s;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      line-height: 1.6;
    }

    header {
      background-color: var(--header-bg);
      color: var(--header-text);
      padding: 20px;
      box-shadow: var(--shadow);
      position: relative;
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
    }

    .app-title {
      font-size: 1.8rem;
      font-weight: 700;
      margin-right: 20px;
    }

    .theme-toggle {
      background: none;
      border: none;
      color: var(--header-text);
      font-size: 1.2rem;
      cursor: pointer;
      padding: 5px;
      border-radius: 50%;
    }

    .profile-summary {
      display: flex;
      align-items: center;
      font-size: 0.9rem;
    }

    .profile-pic {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      margin-right: 10px;
      background-color: var(--secondary-color);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
    }

    nav {
      background-color: var(--card-bg);
      box-shadow: var(--shadow);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .nav-container {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
    }

    .nav-tabs {
      display: flex;
      list-style: none;
    }

    .nav-tabs li {
      position: relative;
    }

    .nav-tabs a {
      color: var(--text-color);
      text-decoration: none;
      padding: 15px 20px;
      display: block;
      font-weight: 500;
      position: relative;
    }

    .nav-tabs a::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 0;
      height: 3px;
      background-color: var(--primary-color);
      transition: width 0.3s;
    }

    .nav-tabs a.active::after,
    .nav-tabs a:hover::after {
      width: 100%;
    }

    .nav-tabs a.active {
      color: var(--primary-color);
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .tab {
      display: none;
      animation: fadeIn 0.5s;
    }

    .tab.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .card {
      background-color: var(--card-bg);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      margin-bottom: 20px;
      overflow: hidden;
    }

    .card-header {
      padding: 15px 20px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .card-title {
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--primary-color);
    }

    .card-body {
      padding: 20px;
    }

    .button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 500;
      transition: background-color 0.3s;
    }

    .button:hover {
      background-color: #2980b9;
    }

    .button.secondary {
      background-color: var(--secondary-color);
    }

    .button.secondary:hover {
      background-color: #27ae60;
    }

    .button.danger {
      background-color: var(--accent-color);
    }

    .button.danger:hover {
      background-color: #c0392b;
    }

    .button.disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
    }

    .form-control {
      width: 100%;
      padding: 10px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      background-color: var(--card-bg);
      color: var(--text-color);
    }

    .form-control:focus {
      outline: none;
      border-color: var(--primary-color);
    }

    .exercise-options {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
    }

    .exercise-option {
      padding: 10px 15px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .exercise-option:hover {
      border-color: var(--primary-color);
    }

    .exercise-option.active {
      background-color: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }

    .workout-area {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .video-container {
      position: relative;
      width: 100%;
      height: 0;
      padding-bottom: 56.25%; /* 16:9 aspect ratio */
      overflow: hidden;
      background-color: #000;
      border-radius: var(--border-radius);
    }

    #videoElement {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: #000;
    }

    #outputCanvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    .workout-controls {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .workout-stats {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .stat-card {
      flex: 1;
      min-width: 150px;
      padding: 15px;
      background-color: var(--card-bg);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      text-align: center;
    }

    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--primary-color);
    }

    .stat-label {
      font-size: 0.9rem;
      color: var(--text-color);
      opacity: 0.8;
    }

    .instruction-card {
      background-color: var(--card-bg);
      border-radius: var(--border-radius);
      padding: 15px;
      margin-bottom: 20px;
      border-left: 4px solid var(--primary-color);
    }

    .nutrition-search {
      margin-bottom: 20px;
    }

    .ingredient-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }

    .ingredient-tag {
      padding: 5px 10px;
      background-color: var(--primary-color);
      color: white;
      border-radius: 20px;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
    }

    .ingredient-tag .remove {
      margin-left: 5px;
      cursor: pointer;
    }

    .recipe-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
    }

    .recipe-card {
      border-radius: var(--border-radius);
      overflow: hidden;
      box-shadow: var(--shadow);
      transition: transform 0.3s;
    }

    .recipe-card:hover {
      transform: translateY(-5px);
    }

    .recipe-image {
      width: 100%;
      height: 200px;
      object-fit: cover;
    }

    .recipe-content {
      padding: 15px;
      background-color: var(--card-bg);
    }

    .recipe-title {
      font-size: 1.1rem;
      margin-bottom: 10px;
      color: var(--text-color);
    }

    .recipe-meta {
      display: flex;
      justify-content: space-between;
      font-size: 0.9rem;
      color: var(--text-color);
      opacity: 0.8;
    }

    .progress-container {
      margin-bottom: 30px;
    }

    .progress-bar {
      height: 20px;
      background-color: var(--border-color);
      border-radius: 10px;
      overflow: hidden;
      margin-top: 10px;
    }

    .progress-fill {
      height: 100%;
      background-color: var(--primary-color);
      border-radius: 10px;
      transition: width 0.3s ease;
    }

    .chart-container {
      height: 300px;
      margin-top: 20px;
    }

    .feedback-message {
      padding: 10px;
      margin: 10px 0;
      border-radius: var(--border-radius);
      background-color: rgba(46, 204, 113, 0.1);
      border-left: 4px solid var(--secondary-color);
    }

    .feedback-message.warning {
      background-color: rgba(231, 76, 60, 0.1);
      border-left-color: var(--accent-color);
    }

    .session-summary {
      background-color: var(--card-bg);
      border-radius: var(--border-radius);
      padding: 20px;
      margin-top: 20px;
      box-shadow: var(--shadow);
      display: none;
    }

    .summary-stats {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .summary-stat {
      text-align: center;
      flex: 1;
    }

    .summary-value {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--primary-color);
    }

    .summary-label {
      font-size: 0.9rem;
      color: var(--text-color);
      opacity: 0.8;
    }

    .feedback-list {
      margin-top: 20px;
    }

    .feedback-item {
      padding: 10px;
      margin-bottom: 10px;
      border-radius: var(--border-radius);
      background-color: var(--bg-color);
      border-left: 3px solid var(--primary-color);
    }

    #repCounter {
      font-size: 5rem;
      font-weight: 700;
      color: var(--primary-color);
      position: absolute;
      top: 10px;
      right: 15px;
      background-color: rgba(0, 0, 0, 0.5);
      padding: 5px 15px;
      border-radius: var(--border-radius);
      z-index: 10;
    }

    @media (max-width: 768px) {
      .app-title {
        font-size: 1.5rem;
      }

      .nav-tabs a {
        padding: 10px 15px;
        font-size: 0.9rem;
      }

      .workout-stats {
        flex-direction: column;
      }

      .stat-card {
        width: 100%;
      }

      .recipe-grid {
        grid-template-columns: 1fr;
      }
    }

    /* For file upload */
    .file-upload {
      position: relative;
      display: inline-block;
      margin: 10px 0;
    }

    .file-upload-input {
      display: none;
    }

    .file-upload-button {
      padding: 10px 20px;
      background-color: var(--primary-color);
      color: white;
      border-radius: 4px;
      cursor: pointer;
      display: inline-block;
    }

    .file-name {
      margin-left: 10px;
    }

    /* Loading indicator */
    .loader {
      border: 4px solid rgba(0, 0, 0, 0.1);
      border-radius: 50%;
      border-top: 4px solid var(--primary-color);
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      display: inline-block;
      vertical-align: middle;
      margin-right: 10px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .hidden {
      display: none;
    }

    /* New styles for enhanced UI */
    .science-callout {
      background-color: rgba(52, 152, 219, 0.1);
      border-left: 4px solid var(--primary-color);
      padding: 10px 15px;
      margin: 10px 0;
      border-radius: 4px;
    }

    .science-callout h4 {
      margin-bottom: 5px;
      color: var(--primary-color);
    }

    .form-cue-list {
      margin: 10px 0 10px 20px;
    }

    .form-cue-list li {
      margin-bottom: 5px;
      position: relative;
      padding-left: 5px;
    }

    .form-cue-list li::before {
      content: "•";
      position: absolute;
      left: -15px;
      color: var(--primary-color);
    }

    .exercise-header {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }

    .exercise-icon {
      width: 40px;
      height: 40px;
      background-color: var(--primary-color);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      margin-right: 15px;
    }

    .difficulty-badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 0.8rem;
      margin-left: 10px;
      background-color: #3498db;
      color: white;
    }

    .difficulty-badge.beginner {
      background-color: var(--secondary-color);
    }

    .difficulty-badge.intermediate {
      background-color: #f39c12;
    }

    .difficulty-badge.advanced {
      background-color: var(--accent-color);
    }

    .muscles-worked {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      margin: 10px 0;
    }

    .muscle-tag {
      background-color: rgba(52, 152, 219, 0.1);
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 0.8rem;
      color: var(--primary-color);
      border: 1px solid var(--primary-color);
    }

    /* Enhanced modal styles */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s, visibility 0.3s;
    }

    .modal.active {
      opacity: 1;
      visibility: visible;
    }

    .modal-content {
      background-color: var(--card-bg);
      border-radius: var(--border-radius);
      width: 80%;
      max-width: 800px;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
    }

    .modal-header {
      padding: 15px 20px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-title {
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--primary-color);
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--text-color);
    }

    .modal-body {
      padding: 20px;
    }

    /* Animations */
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    .pulse {
      animation: pulse 1s infinite;
    }
  </style>
</head>
<body>
  <header>
    <div class="header-content">
      <h1 class="app-title">Stream AI Workout Assistant</h1>
      <div class="profile-summary">
        <div class="profile-pic">
          <i class="fas fa-user"></i>
        </div>
        <div class="profile-info">
          <div class="profile-name">User</div>
          <div class="profile-level">Level 1</div>
        </div>
      </div>
      <button id="themeToggle" class="theme-toggle">
        <i class="fas fa-moon"></i>
      </button>
    </div>
  </header>

  <nav>
    <div class="nav-container">
      <ul class="nav-tabs">
        <li><a href="#workouts" class="tab-link active" data-tab="workouts"><i class="fas fa-dumbbell"></i> Workouts</a></li>
        <li><a href="#nutrition" class="tab-link" data-tab="nutrition"><i class="fas fa-apple-alt"></i> Nutrition</a></li>
        <li><a href="#progress" class="tab-link" data-tab="progress"><i class="fas fa-chart-line"></i> Progress</a></li>
      </ul>
    </div>
  </nav>

  <div class="container">
    <!-- Workouts Tab -->
    <div id="workouts" class="tab active">
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Choose Your Exercise</h2>
        </div>
        <div class="card-body">
          <div class="exercise-options">
            <div class="exercise-option" data-exercise="Squats">Squats</div>
            <div class="exercise-option" data-exercise="Bicep Curls">Bicep Curls</div>
            <div class="exercise-option" data-exercise="Push-Ups">Push-Ups</div>
            <div class="exercise-option" data-exercise="Planks">Planks</div>
            <div class="exercise-option" data-exercise="Lunges">Lunges</div>
          </div>
        </div>
      </div>

      <div class="instruction-card" id="exerciseInstructions">
        <h3>Exercise Instructions</h3>
        <p class="exercise-description">Select an exercise to see instructions.</p>
      </div>

      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Live Workout</h2>
          <div class="workout-controls">
            <button id="startExerciseBtn" class="button disabled"><i class="fas fa-play"></i> Start Exercise</button>
            <button id="endExerciseBtn" class="button danger disabled"><i class="fas fa-stop"></i> End Exercise</button>
          </div>
        </div>
        <div class="card-body">
          <div class="workout-area">
            <div class="video-container">
              <div id="repCounter" class="hidden">0</div>
              <video id="videoElement" autoplay hidden></video>
              <canvas id="outputCanvas"></canvas>
            </div>
            
            <div class="file-upload">
              <label for="videoUpload" class="file-upload-button">
                <i class="fas fa-upload"></i> Upload Workout Video
              </label>
              <input type="file" id="videoUpload" class="file-upload-input" accept="video/*">
              <span class="file-name"></span>
            </div>

            <div id="feedbackArea" class="feedback-message hidden"></div>
            
            <div class="workout-stats">
              <div class="stat-card">
                <div class="stat-value" id="currentReps">0</div>
                <div class="stat-label">Reps Completed</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="avgTime">0.0s</div>
                <div class="stat-label">Avg Rep Time</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="caloriesBurned">0</div>
                <div class="stat-label">Calories</div>
              </div>
            </div>
          </div>

          <div id="sessionSummary" class="session-summary">
            <h3>Workout Summary</h3>
            <div class="summary-stats">
              <div class="summary-stat">
                <div class="summary-value" id="summaryReps">0</div>
                <div class="summary-label">Total Reps</div>
              </div>
              <div class="summary-stat">
                <div class="summary-value" id="summaryTime">0:00</div>
                <div class="summary-label">Workout Time</div>
              </div>
              <div class="summary-stat">
                <div class="summary-value" id="summaryCalories">0</div>
                <div class="summary-label">Calories Burned</div>
              </div>
            </div>
            <h4>Form Feedback</h4>
            <div id="feedbackList" class="feedback-list"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Nutrition Tab -->
    <div id="nutrition" class="tab">
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Find Healthy Recipes</h2>
        </div>
        <div class="card-body">
          <div class="nutrition-search">
            <div class="form-group">
              <label for="ingredientInput">Enter ingredients you have:</label>
              <div class="input-group">
                <input type="text" id="ingredientInput" class="form-control" placeholder="e.g., chicken, broccoli, rice">
                <button id="addIngredientBtn" class="button">Add</button>
              </div>
            </div>
            <div class="ingredient-tags" id="ingredientTags"></div>
            <button id="searchRecipesBtn" class="button"><i class="fas fa-search"></i> Find Recipes</button>
          </div>
          
          <div id="recipesLoading" class="hidden">
            <div class="loader"></div> Searching for recipes...
          </div>
          
          <div id="recipeResults" class="recipe-grid"></div>
        </div>
      </div>
    </div>

    <!-- Progress Tab -->
    <div id="progress" class="tab">
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Your Fitness Journey</h2>
        </div>
        <div class="card-body">
          <div class="progress-container">
            <h3>Level Progress</h3>
            <div class="progress-bar">
              <div class="progress-fill" id="levelProgress" style="width: 35%;"></div>
            </div>
            <div style="display: flex; justify-content: space-between; margin-top: 5px;">
              <span>Level 1</span>
              <span>Level 2</span>
            </div>
          </div>
          
          <h3>Exercise History</h3>
          <div class="chart-container">
            <canvas id="progressChart"></canvas>
          </div>
          
          <div class="exercise-summary">
            <h3>Exercise Summary</h3>
            <div class="workout-stats">
              <div class="stat-card">
                <div class="stat-value" id="SquatsCount">0</div>
                <div class="stat-label">Squats</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="BicepCurlsCount">0</div>
                <div class="stat-label">Bicep Curls</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="PushUpsCount">0</div>
                <div class="stat-label">Push-Ups</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="PlanksCount">0</div>
                <div class="stat-label">Planks</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="LungesCount">0</div>
                <div class="stat-label">Lunges</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Recipe Details Modal -->
  <div id="recipeModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="recipeModalTitle">Recipe Details</h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body" id="recipeModalBody">
        <!-- Recipe details will be loaded here -->
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/chart.js/3.7.0/chart.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tensorflow/4.2.0/tf.min.js"></script>
  <script>
    // Theme toggling
    const themeToggle = document.getElementById('themeToggle');
    const body = document.body;
    
    themeToggle.addEventListener('click', () => {
      body.classList.toggle('dark-mode');
      
      if (body.classList.contains('dark-mode')) {
        themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
        localStorage.setItem('theme', 'dark');
      } else {
        themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
        localStorage.setItem('theme', 'light');
      }
    });
    
    // Check for saved theme preference
    if (localStorage.getItem('theme') === 'dark') {
      body.classList.add('dark-mode');
      themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
    }
    
    // Tab switching
    const tabs = document.querySelectorAll('.tab-link');
    const tabContents = document.querySelectorAll('.tab');
    
    tabs.forEach(tab => {
      tab.addEventListener('click', (e) => {
        e.preventDefault();
        tabs.forEach(t => t.classList.remove('active'));
        tabContents.forEach(c => c.classList.remove('active'));
        
        tab.classList.add('active');
        const tabId = tab.getAttribute('data-tab');
        document.getElementById(tabId).classList.add('active');
      });
    });
    
    // Exercise selection
    const exerciseOptions = document.querySelectorAll('.exercise-option');
    const exerciseInstructions = document.getElementById('exerciseInstructions');
    const startExerciseBtn = document.getElementById('startExerciseBtn');
    let selectedExercise = null;
    
    exerciseOptions.forEach(option => {
      option.addEventListener('click', () => {
        exerciseOptions.forEach(o => o.classList.remove('active'));
        option.classList.add('active');
        selectedExercise = option.getAttribute('data-exercise');
        updateExerciseInstructions(selectedExercise);
        startExerciseBtn.classList.remove('disabled');
      });
    });
    
    function updateExerciseInstructions(exercise) {
      const instructions = {
        'Squats': {
          description: 'A compound exercise that targets the quadriceps, hamstrings, and glutes.',
          steps: [
            'Stand with feet shoulder-width apart',
            'Keep your back straight and chest up', 
            'Lower your body by bending your knees, as if sitting back into a chair',
            'Keep knees aligned with toes and don\'t let them go beyond your toes',
            'Lower until thighs are parallel to the ground (or as far as comfortable)',
            'Push through your heels to return to starting position'
          ],
          science: 'Squats activate multiple muscle groups simultaneously, increasing growth hormone production and improving overall lower body strength. Proper form reduces knee strain by distributing weight properly through the posterior chain.',
          difficulty: 'beginner',
          muscles: ['Quadriceps', 'Hamstrings', 'Glutes', 'Core']
        },
        'Bicep Curls': {
          description: 'An isolation exercise that targets the biceps brachii.',
          steps: [
            'Stand with feet shoulder-width apart',
            'Hold dumbbells with arms fully extended and palms facing forward',
            'Keep your elbows close to your torso',
            'Curl the weights up toward your shoulders while contracting your biceps',
            'Slowly lower the weights back to the starting position',
            'Maintain proper posture throughout the movement'
          ],
          science: 'Bicep curls isolate the biceps brachii, developing arm strength and muscle definition. Controlled eccentric (lowering) phase is crucial for maximizing muscle fiber recruitment.',
          difficulty: 'beginner',
          muscles: ['Biceps', 'Forearms']
        },
        'Push-Ups': {
          description: 'A compound exercise that targets the chest, shoulders, and triceps.',
          steps: [
            'Begin in a plank position with hands slightly wider than shoulder-width apart',
            'Keep your body in a straight line from head to heels',
            'Lower your chest toward the floor by bending your elbows',
            'Keep your elbows at a 45-degree angle to your body (not flared out)',
            'Lower until your chest nearly touches the floor',
            'Push back up to the starting position by extending your arms'
          ],
          science: 'Push-ups engage multiple upper body muscle groups simultaneously while requiring core stabilization. The close chain nature of this exercise recruits more stabilizing muscles than machine alternatives.',
          difficulty: 'intermediate',
          muscles: ['Chest', 'Shoulders', 'Triceps', 'Core']
        },
        'Planks': {
          description: 'An isometric core exercise that builds endurance and stability.',
          steps: [
            'Start in a forearm plank position with elbows directly beneath shoulders',
            'Keep your body in a straight line from head to heels',
            'Engage your core by pulling your navel toward your spine',
            'Keep your shoulders down and back, not hunched',
            'Hold this position while breathing normally',
            'Maintain proper form throughout the duration'
          ],
          science: 'Planks activate the transverse abdominis, the deepest layer of abdominal muscles, which is essential for spine protection and core stability. Isometric contractions improve muscular endurance without spinal flexion.',
          difficulty: 'beginner',
          muscles: ['Core', 'Shoulders', 'Back', 'Glutes']
        },
        'Lunges': {
          description: 'A unilateral exercise that targets the quadriceps, hamstrings, and glutes.',
          steps: [
            'Stand with feet hip-width apart',
            'Step forward with one leg, keeping your upper body straight',
            'Lower your hips until both knees are bent at about a 90-degree angle',
            'Front knee should be directly above the ankle, not pushed forward',
            'Back knee should hover just above the ground',
            'Push through the front heel to return to starting position',
            'Repeat with the other leg'
          ],
          science: 'Lunges address muscular imbalances by working legs independently. The unilateral nature improves balance, coordination, and functional strength. The exercise activates stabilizing hip muscles often underdeveloped with bilateral exercises.',
          difficulty: 'intermediate',
          muscles: ['Quadriceps', 'Hamstrings', 'Glutes', 'Core']
        }
      };
      
      const exerciseInfo = instructions[exercise];
      
      let stepsHTML = '<ul class="form-cue-list">';
      exerciseInfo.steps.forEach(step => {
        stepsHTML += `<li>${step}</li>`;
      });
      stepsHTML += '</ul>';
      
      let musclesHTML = '<div class="muscles-worked">';
      exerciseInfo.muscles.forEach(muscle => {
        musclesHTML += `<span class="muscle-tag">${muscle}</span>`;
      });
      musclesHTML += '</div>';
      
      const html = `
        <div class="exercise-header">
          <div class="exercise-icon"><i class="fas fa-dumbbell"></i></div>
          <h3>${exercise} <span class="difficulty-badge ${exerciseInfo.difficulty}">${exerciseInfo.difficulty.charAt(0).toUpperCase() + exerciseInfo.difficulty.slice(1)}</span></h3>
        </div>
        <p class="exercise-description">${exerciseInfo.description}</p>
        <h4>Muscles Worked:</h4>
        ${musclesHTML}
        <h4>Proper Form:</h4>
        ${stepsHTML}
        <div class="science-callout">
          <h4><i class="fas fa-flask"></i> Exercise Science:</h4>
          <p>${exerciseInfo.science}</p>
        </div>
      `;
      
      exerciseInstructions.innerHTML = html;
    }
    
    // Workout functionality
    const videoElement = document.getElementById('videoElement');
    const outputCanvas = document.getElementById('outputCanvas');
    const startBtn = document.getElementById('startExerciseBtn');
    const endBtn = document.getElementById('endExerciseBtn');
    const repCounter = document.getElementById('repCounter');
    const currentRepsElement = document.getElementById('currentReps');
    const avgTimeElement = document.getElementById('avgTime');
    const caloriesBurnedElement = document.getElementById('caloriesBurned');
    const feedbackArea = document.getElementById('feedbackArea');
    const sessionSummary = document.getElementById('sessionSummary');
    const summaryReps = document.getElementById('summaryReps');
    const summaryTime = document.getElementById('summaryTime');
    const summaryCalories = document.getElementById('summaryCalories');
    const feedbackList = document.getElementById('feedbackList');
    
    let stream = null;
    let isExercising = false;
    let reps = 0;
    let startTime = null;
    let repTimes = [];
    let feedbacks = [];
    let poseDetectionModel = null;
    let ctx = outputCanvas.getContext('2d');
    
    // Function to initialize camera
    async function initCamera() {
      try {
        // Using lower resolution to reduce lag
        const constraints = {
          video: {
            width: { ideal: 640 },
            height: { ideal: 480 },
            facingMode: 'user',
            frameRate: { ideal: 30 }
          }
        };
        
        stream = await navigator.mediaDevices.getUserMedia(constraints);
        videoElement.srcObject = stream;
        
        // Set canvas dimensions to match video
        videoElement.onloadedmetadata = () => {
          outputCanvas.width = videoElement.videoWidth;
          outputCanvas.height = videoElement.videoHeight;
          videoElement.hidden = false;
        };
        
        return true;
      } catch (err) {
        console.error('Error accessing camera:', err);
        feedbackArea.textContent = 'Camera access error: ' + err.message;
        feedbackArea.classList.remove('hidden');
        return false;
      }
    }
    
    // Load TensorFlow.js pose detection model
    async function loadPoseDetectionModel() {
      try {
        // Show loading indicator
        feedbackArea.textContent = 'Loading exercise analysis model...';
        feedbackArea.classList.remove('hidden');
        
        // In a real implementation, you would load a pre-trained model
        // For this demo, we'll simulate model loading
        await new Promise(resolve => setTimeout(resolve, 1500));
        
        feedbackArea.textContent = 'Model loaded successfully!';
        setTimeout(() => {
          feedbackArea.classList.add('hidden');
        }, 2000);
        
        return true;
      } catch (err) {
        console.error('Error loading model:', err);
        feedbackArea.textContent = 'Error loading model: ' + err.message;
        return false;
      }
    }
    
    // Simulated pose detection and rep counting
    function detectPoseAndCountReps() {
      if (!isExercising) return;
      
      ctx.clearRect(0, 0, outputCanvas.width, outputCanvas.height);
      ctx.drawImage(videoElement, 0, 0, outputCanvas.width, outputCanvas.height);
      
      // In a real implementation, run pose detection here
      // For this demo, we'll simulate rep counting and feedback
      
      // Randomly increment rep count (approximately every 3 seconds)
      if (Math.random() < 0.01) {
        reps++;
        repCounter.textContent = reps;
        currentRepsElement.textContent = reps;
        
        // Calculate time for this rep
        const now = new Date();
        if (repTimes.length > 0) {
          const lastRepTime = now - repTimes[repTimes.length - 1];
          repTimes.push(now);
          
          // Update average rep time
          const totalTime = repTimes.reduce((sum, time, i) => {
            if (i === 0) return 0;
            return sum + (time - repTimes[i-1]);
          }, 0);
          
          const avgTime = totalTime / (repTimes.length - 1) / 1000;
          avgTimeElement.textContent = avgTime.toFixed(1) + 's';
          
          // Generate random feedback on occasion
          if (Math.random() < 0.3) {
            const feedbackOptions = [
              'Great form! Keep it up!',
              'Try to go a bit deeper on your next rep.',
              'Remember to keep your back straight.',
              'Excellent range of motion!',
              'Slow down slightly for better muscle engagement.'
            ];
            
            const feedback = feedbackOptions[Math.floor(Math.random() * feedbackOptions.length)];
            feedbackArea.textContent = feedback;
            feedbackArea.classList.remove('hidden');
            feedbacks.push(feedback);
            
            setTimeout(() => {
              feedbackArea.classList.add('hidden');
            }, 3000);
          }
        } else {
          repTimes.push(now);
        }
        
        // Update calories (simple estimate)
        const caloriesPerRep = {
          'Squats': 0.32,
          'Bicep Curls': 0.15,
          'Push-Ups': 0.29,
          'Planks': 0.05, // per second
          'Lunges': 0.3
        };
        
        const calories = Math.round(reps * (caloriesPerRep[selectedExercise] || 0.2));
        caloriesBurnedElement.textContent = calories;
      }
      
      // Draw skeletal overlay (simplified for demo)
      if (reps > 0) {
        drawSimplifiedSkeleton();
      }
      
      requestAnimationFrame(detectPoseAndCountReps);
    }
    
    // Draw a simplified skeleton overlay on the canvas
    function drawSimplifiedSkeleton() {
      // Simple stick figure-like skeleton
      ctx.strokeStyle = '#3498db';
      ctx.lineWidth = 4;
      
      // This is a very simplified skeleton just for visual effect
      // In a real implementation, you would use actual pose keypoints
      
      // Randomize slightly to simulate movement
      const centerX = outputCanvas.width / 2 + (Math.random() * 10 - 5);
      const topY = outputCanvas.height / 4 + (Math.random() * 10 - 5);
      
      // Head
      ctx.beginPath();
      ctx.arc(centerX, topY, 20, 0, Math.PI * 2);
      ctx.stroke();
      
      // Body
      ctx.beginPath();
      ctx.moveTo(centerX, topY + 20);
      ctx.lineTo(centerX, topY + 100);
      ctx.stroke();
      
      // Arms
      ctx.beginPath();
      ctx.moveTo(centerX, topY + 40);
      ctx.lineTo(centerX - 40, topY + 70 + (Math.random() * 10 - 5));
      ctx.moveTo(centerX, topY + 40);
      ctx.lineTo(centerX + 40, topY + 70 + (Math.random() * 10 - 5));
      ctx.stroke();
      
      // Legs
      ctx.beginPath();
      ctx.moveTo(centerX, topY + 100);
      ctx.lineTo(centerX - 30, topY + 180 + (Math.random() * 10 - 5));
      ctx.moveTo(centerX, topY + 100);
      ctx.lineTo(centerX + 30, topY + 180 + (Math.random() * 10 - 5));
      ctx.stroke();
    }
    
    // Start exercise
    startBtn.addEventListener('click', async function() {
      if (selectedExercise && !isExercising) {
        // Initialize camera
        const cameraInitialized = await initCamera();
        if (!cameraInitialized) return;
        
        // Load pose detection model
        const modelLoaded = await loadPoseDetectionModel();
        if (!modelLoaded) return;
        
        // Start exercise tracking
        isExercising = true;
        startTime = new Date();
        repCounter.textContent = '0';
        repCounter.classList.remove('hidden');
        startBtn.classList.add('disabled');
        endBtn.classList.remove('disabled');
        reps = 0;
        repTimes = [];
        feedbacks = [];
        
        // Start detection loop
        detectPoseAndCountReps();
      }
    });
    
    // End exercise
    endBtn.addEventListener('click', function() {
      if (isExercising) {
        isExercising = false;
        
        // Stop camera
        if (stream) {
          stream.getTracks().forEach(track => track.stop());
        }
        
        videoElement.srcObject = null;
        videoElement.hidden = true;
        repCounter.classList.add('hidden');
        startBtn.classList.remove('disabled');
        endBtn.classList.add('disabled');
        
        // Update exercise stats in progress tab
        const exerciseCountElement = document.getElementById(`${selectedExercise.replace('-', '')}Count`);
        if (exerciseCountElement) {
          exerciseCountElement.textContent = parseInt(exerciseCountElement.textContent) + reps;
        }
        
        // Update level progress (simple simulation)
        const levelProgressBar = document.getElementById('levelProgress');
        const currentWidth = parseInt(levelProgressBar.style.width);
        const newWidth = Math.min(currentWidth + reps / 2, 100);
        levelProgressBar.style.width = `${newWidth}%`;
        
        // Update workout chart
        updateWorkoutChart(selectedExercise, reps);
        
        // Show session summary
        showSessionSummary();
      }
    });
    
    // Show session summary
    function showSessionSummary() {
      const endTime = new Date();
      const workoutDuration = Math.floor((endTime - startTime) / 1000); // in seconds
      
      // Format duration
      const minutes = Math.floor(workoutDuration / 60);
      const seconds = workoutDuration % 60;
      const formattedTime = `${minutes}:${seconds < 10 ? '0' + seconds : seconds}`;
      
      // Update summary
      summaryReps.textContent = reps;
      summaryTime.textContent = formattedTime;
      
      const caloriesPerRep = {
        'Squats': 0.32,
        'Bicep Curls': 0.15,
        'Push-Ups': 0.29,
        'Planks': 0.05, // per second
        'Lunges': 0.3
      };
      
      const calories = Math.round(reps * (caloriesPerRep[selectedExercise] || 0.2));
      summaryCalories.textContent = calories;
      
      // Display feedback items
      feedbackList.innerHTML = '';
      if (feedbacks.length > 0) {
        feedbacks.forEach(feedback => {
          const feedbackItem = document.createElement('div');
          feedbackItem.className = 'feedback-item';
          feedbackItem.textContent = feedback;
          feedbackList.appendChild(feedbackItem);
        });
      } else {
        const noFeedbackItem = document.createElement('div');
        noFeedbackItem.className = 'feedback-item';
        noFeedbackItem.textContent = 'No specific feedback - your form looked good!';
        feedbackList.appendChild(noFeedbackItem);
      }
      
      // Show summary
      sessionSummary.style.display = 'block';
    }
    
    // Update workout progress chart
    function updateWorkoutChart(exercise, count) {
      const ctx = document.getElementById('progressChart').getContext('2d');
      
      // If chart already exists, update data
      if (window.workoutChart) {
        const datasetIndex = window.workoutChart.data.labels.indexOf(exercise);
        if (datasetIndex >= 0) {
          window.workoutChart.data.datasets[0].data[datasetIndex] += count;
        } else {
          window.workoutChart.data.labels.push(exercise);
          window.workoutChart.data.datasets[0].data.push(count);
        }
        window.workoutChart.update();
        return;
      }
      
      // Create new chart
      const data = {
        labels: [exercise],
        datasets: [{
          label: 'Reps Completed',
          data: [count],
          backgroundColor: [
            'rgba(52, 152, 219, 0.6)',
            'rgba(46, 204, 113, 0.6)',
            'rgba(231, 76, 60, 0.6)',
            'rgba(155, 89, 182, 0.6)',
            'rgba(241, 196, 15, 0.6)'
          ],
          borderColor: [
            'rgba(52, 152, 219, 1)',
            'rgba(46, 204, 113, 1)',
            'rgba(231, 76, 60, 1)',
            'rgba(155, 89, 182, 1)',
            'rgba(241, 196, 15, 1)'
          ],
          borderWidth: 1
        }]
      };
      
      window.workoutChart = new Chart(ctx, {
        type: 'bar',
        data: data,
        options: {
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    }
    
    // Video upload functionality
    const videoUpload = document.getElementById('videoUpload');
    const fileName = document.querySelector('.file-name');
    
    videoUpload.addEventListener('change', function(e) {
      if (this.files && this.files[0]) {
        fileName.textContent = this.files[0].name;
        
        // Process uploaded video
        const fileURL = URL.createObjectURL(this.files[0]);
        videoElement.src = fileURL;
        videoElement.hidden = false;
        videoElement.loop = true;
        videoElement.onloadedmetadata = () => {
          outputCanvas.width = videoElement.videoWidth;
          outputCanvas.height = videoElement.videoHeight;
          videoElement.play();
        };
        
        // Enable start button
        if (selectedExercise) {
          startBtn.classList.remove('disabled');
        }
      }
    });
    
    // Nutrition tab functionality
    const ingredientInput = document.getElementById('ingredientInput');
    const addIngredientBtn = document.getElementById('addIngredientBtn');
    const ingredientTags = document.getElementById('ingredientTags');
    const searchRecipesBtn = document.getElementById('searchRecipesBtn');
    const recipeResults = document.getElementById('recipeResults');
    const recipesLoading = document.getElementById('recipesLoading');
    
    let ingredients = [];
    
    // Add ingredient to the list
    function addIngredient() {
      const ingredient = ingredientInput.value.trim();
      if (ingredient && !ingredients.includes(ingredient)) {
        ingredients.push(ingredient);
        updateIngredientTags();
        ingredientInput.value = '';
      }
    }
    
    // Update ingredient tags display
    function updateIngredientTags() {
      ingredientTags.innerHTML = '';
      ingredients.forEach((ingredient, index) => {
        const tag = document.createElement('div');
        tag.className = 'ingredient-tag';
        tag.innerHTML = `${ingredient} <span class="remove" data-index="${index}">&times;</span>`;
        ingredientTags.appendChild(tag);
      });
      
      // Add remove event listeners
      document.querySelectorAll('.ingredient-tag .remove').forEach(btn => {
        btn.addEventListener('click', function() {
          const index = parseInt(this.getAttribute('data-index'));
          ingredients.splice(index, 1);
          updateIngredientTags();
        });
      });
    }
    
    // Add ingredient when clicking Add button
    addIngredientBtn.addEventListener('click', addIngredient);
    
    // Add ingredient when pressing Enter
    ingredientInput.addEventListener('keyup', function(e) {
      if (e.key === 'Enter') {
        addIngredient();
      }
    });
    
    // Search for recipes
    searchRecipesBtn.addEventListener('click', async function() {
      if (ingredients.length === 0) {
        alert('Please add at least one ingredient');
        return;
      }
      
      // Show loading indicator
      recipesLoading.classList.remove('hidden');
      recipeResults.innerHTML = '';
      
      // In a real implementation, you would call an API like Spoonacular
      // For this demo, we'll simulate API response with sample data
      await new Promise(resolve => setTimeout(resolve, 1500));
      
      // Sample recipe data
      const recipes = [
        {
          id: 1,
          title: 'Chicken & Vegetable Stir Fry',
          image: 'https://spoonacular.com/recipeImages/632583-556x370.jpg',
          readyInMinutes: 30,
          calories: 320,
          protein: 28
        },
        {
          id: 2,
          title: 'Protein-Packed Quinoa Bowl',
          image: 'https://spoonacular.com/recipeImages/642585-556x370.jpg',
          readyInMinutes: 25,
          calories: 380,
          protein: 15
        },
        {
          id: 3,
          title: 'Greek Yogurt Parfait',
          image: 'https://spoonacular.com/recipeImages/642605-556x370.jpg',
          readyInMinutes: 10,
          calories: 210,
          protein: 18
        },
        {
          id: 4,
          title: 'Salmon with Roasted Vegetables',
          image: 'https://spoonacular.com/recipeImages/659135-556x370.jpg',
          readyInMinutes: 35,
          calories: 420,
          protein: 32
        }
      ];
      
      // Display recipes
      recipes.forEach(recipe => {
        const recipeCard = document.createElement('div');
        recipeCard.className = 'recipe-card';
        recipeCard.setAttribute('data-id', recipe.id);
        
        recipeCard.innerHTML = `
          <img src="${recipe.image}" alt="${recipe.title}" class="recipe-image">
          <div class="recipe-content">
            <h3 class="recipe-title">${recipe.title}</h3>
            <div class="recipe-meta">
              <span><i class="far fa-clock"></i> ${recipe.readyInMinutes} min</span>
              <span><i class="fas fa-fire"></i> ${recipe.calories} cal</span>
              <span><i class="fas fa-drumstick-bite"></i> ${recipe.protein}g protein</span>
            </div>
          </div>
        `;
        
        recipeResults.appendChild(recipeCard);
        
        // Add click event to view recipe details
        recipeCard.addEventListener('click', () => {
          showRecipeDetails(recipe);
        });
      });
      
      // Hide loading indicator
      recipesLoading.classList.add('hidden');
    });
    
    // Recipe modal
    const recipeModal = document.getElementById('recipeModal');
    const recipeModalTitle = document.getElementById('recipeModalTitle');
    const recipeModalBody = document.getElementById('recipeModalBody');
    const modalClose = document.querySelector('.modal-close');
    
    // Show recipe details in modal
    function showRecipeDetails(recipe) {
      recipeModalTitle.textContent = recipe.title;
      
      // In a real implementation, you would fetch detailed recipe data
      // For this demo, we'll use sample data
      recipeModalBody.innerHTML = `
        <img src="${recipe.image}" alt="${recipe.title}" style="width: 100%; border-radius: var(--border-radius); margin-bottom: 15px;">
        
        <div class="recipe-stats" style="display: flex; gap: 15px; margin-bottom: 15px;">
          <div class="stat-card">
            <div class="stat-value">${recipe.readyInMinutes}</div>
            <div class="stat-label">Minutes</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">${recipe.calories}</div>
            <div class="stat-label">Calories</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">${recipe.protein}g</div>
            <div class="stat-label">Protein</div>
          </div>
        </div>
        
        <h4>Ingredients</h4>
        <ul class="form-cue-list">
          <li>4 oz protein (chicken, tofu, etc.)</li>
          <li>1 cup mixed vegetables</li>
          <li>2 tbsp olive oil</li>
          <li>Herbs and spices to taste</li>
          <li>1/2 cup grain (rice, quinoa, etc.)</li>
        </ul>
        
        <h4>Instructions</h4>
        <ol style="margin-left: 20px;">
          <li>Prepare your protein and vegetables.</li>
          <li>Heat oil in a pan over medium-high heat.</li>
          <li>Cook protein until done, then set aside.</li>
          <li>Add vegetables to the pan and cook until tender.</li>
          <li>Combine with cooked grain and protein.</li>
          <li>Season to taste and serve warm.</li>
        </ol>
        
        <h4>Nutrition Facts</h4>
        <div class="science-callout">
          <p>This balanced meal provides essential macronutrients to support your workout recovery. The protein helps repair muscle tissue, while complex carbohydrates restore glycogen stores. The healthy fats support hormone production and nutrient absorption.</p>
        </div>
      `;
      
      recipeModal.classList.add('active');
    }
    
    // Close modal when clicking X
    modalClose.addEventListener('click', () => {
      recipeModal.classList.remove('active');
    });
    
    // Close modal when clicking outside
    window.addEventListener('click', (e) => {
      if (e.target === recipeModal) {
        recipeModal.classList.remove('active');
      }
    });
    
    // Initialize the application
    function initApp() {
      // Default to Workouts tab
      document.querySelector('.tab-link[data-tab="workouts"]').click();
      
      // Initialize workout chart
      const ctx = document.getElementById('progressChart').getContext('2d');
      window.workoutChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: [],
          datasets: [{
            label: 'Reps Completed',
            data: [],
            backgroundColor: [
              'rgba(52, 152, 219, 0.6)',
              'rgba(46, 204, 113, 0.6)',
              'rgba(231, 76, 60, 0.6)',
              'rgba(155, 89, 182, 0.6)',
              'rgba(241, 196, 15, 0.6)'
            ],
            borderColor: [
              'rgba(52, 152, 219, 1)',
              'rgba(46, 204, 113, 1)',
              'rgba(231, 76, 60, 1)',
              'rgba(155, 89, 182, 1)',
              'rgba(241, 196, 15, 1)'
            ],
            borderWidth: 1
          }]
        },
        options: {
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    }
    
    // Initialize the application when DOM is loaded
    document.addEventListener('DOMContentLoaded', initApp);
  </script>
</body>
</html>